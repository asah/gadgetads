<html>
<head>
<title>How to Build a Google Gadget Ad</title>
<link rel="stylesheet" type="text/css" href="http://code.google.com/css/dev_docs.css">
<style><!--
.google_conf {
  font-weight: bold;
  font-size: 12px;
  color: #cc0000;
}
--></style>
</head>
<body>
<div class="google_conf">
  GOOGLE CONFIDENTIAL AND PROPRIETARY<br>
  Do not distribute without written consent and authorization from Google Inc.<br>
  Google Gadget Ads have not been officially launched to the public.
</div>

<h1>How to Build a Google Gadget Ad</h1>

<!-- TOC -->
<ul>
  <li><a href="#intro">Introduction</a></li>
  <li><a href="#adsgadgets">Gadget Ads vs. Google Gadgets</a></li>
  <li><a href="#gettingstarted">Getting Started</a></li>
  <li><a href="#clickurl">Defining and Using the Click URL</a></li>
  <li><a href="#policy">Conforming to IAB and Google Advertising Policies</a></li>
  <li><a href="#remotecontent">Getting Remote Content</a></li>
  <li><a href="#images">Embedding Images: Recommended</a></li>
  <li>
    <a href="#flash">Embedding Flash and Video Content</a>
    <ul>
      <li><a href="#flash_cache">Caching Flash Content on Google</a></li>
      <li><a href="#flash_clickurl">Passing the Click URL into Flash</a></li>
      <li><a href="#flash_youtube">Using the YouTube Branded Player For Video Playback</a></li>
      <li><a href="#flash_nonbranded">Using your own Flash player with YouTube Videos</a></li>
    </ul>
  </li>
  <li><a href="#map">Embedding Google Maps</a></li>
  <li><a href="#casestudy">Case Study: Simplified Gmail Gadget Ad</a></li>
  <li><a href="#finaloutcome">The Final Outcome</a></li>
  <li><a href="#resources">Resources</a></li>
  <li><a href="#scratchpad">Scratch Pad</a></li>
</ul>

<a name="introduction"></a>
<h2>Introduction</h2>
<p>
  This tutorial takes you through the various steps to create a gadget ad. We'll describe how to get 
  started and cover various ways to include interesting content in your gadget. Lastly, we'll work 
  through a case study using one of our existing gadget ads, taking you step-by-step through building
  it as if it's being built for the first time. 
  At the end, you'll have a higher level of understanding of gadgets, how they work, and how to begin writing 
  your own effective gadget ads.  We also recommend using the <a href="#scratchpad">gadget scratch pad</a> as you follow
  along with the examples below.
</p>

<a name="adsgadgets"></a>
<h2>Gadget Ads vs. Google Gadgets</h2>
<p>
  Gadget Ads are simply Google Gadgets with rich, interactive content designed to attract users to a product.  Architecturally,
  they're exactly the same.  The only new concept introduced is the <code>clickurl</code>, which is 
  discussed in more detail below.  It's used to track user clicks inside the ad and record the hits
  in the ads database.
</p>
<p>
  Just like Google Gadgets, once a gadget ad is created, it can be distributed and added to Google 
  Personalized Homepage, Google Desktop, blogs, websites, etc.  Since gadget ads and Google Gadgets are created in more or less the same way, 
  we highly recommend familiarizing yourself with the <a href="http://www.google.com/apis/gadgets/index.html">Google Gadgets API documentation</a>.  
  Understanding what gadgets are, how they work, and what features 
  are available can significantly increase your ability to create high-quality gadget ads that are capable of reaching millions of users.
</p>

<a name="gettingstarted"></a>
<h2>Getting Started</h2>
<p>
  The <a href="http://www.google.com/ig">personalized homepage</a> is a great place to develop and 
  test your gadget. There are a few things to do before you can begin designing your gadget. 
  These simple instructions take you through the initial steps.
</p>

<h3>Add the Developer Gadget</h3>
<p>
  The developer gadget acts a "command center" for all gadgets on your personalized homepage. In addition to listing all the gadgets that you're running, 
  it lets you add, view, and manage gadgets. The developer gadget provides features that you'll need when developing your gadget such as 
  disabling gadget caching.  This prevents your gadget from being cached and lets you see your changes immediately.
</p>
<p>
  Go ahead and <a href="http://fusion.google.com/add?moduleurl=developer.xml">add the developer gadget</a>.  For more information, visit the
  <a href="http://www.google.com/apis/gadgets/basic.html#DevModStart">documentation</a>.
</p>

<h3>Create an Empty Gadget</h3>
<p>
  First, you'll want to add a new blank gadget to your homepage. We're not worried about content, so the gadget can initially be empty.
</p>
<p>
  Using a text editor of your choice, copy and paste the gadget template below into a file,
  save it, and upload it to your public web server:
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;My First Gadget Ad&quot;/&gt;
  &lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;&quot;/&gt;
  &lt;Content type=&quot;html&quot;&gt;&lt;![CDATA[
    <b>ALL HTML CONTENT GOES HERE</b>
  ]]&gt;&lt;/Content&gt;
&lt;/Module&gt;</pre>
</p>
<p>
  Gadget content is simply HTML and should be added between the opening and closing <code>CDATA</code> tags.  Everything
  inside here represents gadget ad content and can contain any valid HTML syntax.
</p>

<h3>Disable Caching</h3>
<p>
  After the gadget is uploaded, add it to your homepage using the developer gadget. Using the 
  developer gadget, disable caching for your newly-added gadget. This ensures that your 
  changes will immediately be visible while developing your gadget. Once this is done, 
  you can make changes to the gadget and re-upload it to the hosting server. You can 
  simply reload the homepage to see the changes you made.
</p>

<h3>Set the Width and Height</h3>
<p>
  Set gadget dimensions early on so you can figure out the best way to layout your content 
  inside the gadget.  Under <code>ModulePrefs</code>, the width and height should be specified in number of pixels:
<pre>&lt;ModulePrefs title="My First Gadget Ad" <b>width="250" height="200"</b>/&gt;</pre>
</p>

<a name="clickurl"></a>
<h2>Defining the Click URL</h2>
<p>
  The click URL is a mechanism used to track user-interaction inside a gadget ad. It should be included in the
  gadget XML as a hidden UserPref named <code>clickurl</code>.  All click URLs should end with an open URL parameter, <code>&amp;url=</code>
  which will be used to append the target destination for tracked links in your gadget.
</p>
<p>
  We provide a test click URL that you can use when developing your gadget ad.  Instead of sending real clicks 
  to the ads database, 
  it'll create a simple pop-up that displays the target destination.  This is useful when you want to verify that your links are
  tracking correctly and that requests are correctly being sent to the click URL.
  <pre>&lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;<b>http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=</b>&quot;/&gt;</pre>
</p>
<p>
  Make note of this test click URL as you will be using it while developing your gadget ads:<br>
  <a href="http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=">http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=</a>
</p>

<h3>Experiment: Test the Click URL</h3>
<p>
  The links below are all set to route through the test click URL
  described above.  Try clicking on a few to see the confirmation pop-up which confirms
  that click-throughs are being tracked properly.  If you set up click URLs correctly in your gadget,
  then you should see similar results:
  <ul>
    <li><a href="http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=http://www.google.com/">http://www.google.com</a></li>
    <li><a href="http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=http://www.amazon.com">Amazon.com</a></li>
    <li><a href="http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=http://www.google.com/ig/directory">Content directory</a></li>
  </ul>
</p>

<h3>How To Use the Click URL</h2>
<p>
  Once again, gadget content is simply made up of HTML.  So traditionally, the way you'd create a link in HTML
  is by creating an anchor tag that looks something like this:
  <pre>&lt;a target="_top" href="http://mytargetdomain.com"&gt;Target Link&lt;/a&gt;</pre>
</p
<p>
  However, this link won't be tracked by the ads system because it didn't go through the <code>clickurl</code>.
  Instead, you'll need to use JavaScript to generate and assign the URL to these links.  There are various ways
  to do this, but here's one simple step-by-step overview to get you started:
  <ol>
    <li>
      Create an <code>id</code> attribute in your anchor tag and assign it a unique value.
      The <code>href</code> attribute should also contain the target destination.
      <pre>&lt;a id="<b>link1</b>" target="_top" href="<b>http://mytargetdomain.com</b>"&gt;Target Link&lt;/a&gt;</pre>
    </li>
    <li>
      Set up an event handler function using <a href="http://www.google.com/apis/gadgets/reference.html#Core">_IG_RegisterOnloadHandler(func)</a>.
      This method accepts a single argument, which is a function that gets called after the entire gadget loads.  This is recommended
      to ensure that all anchor tags defined in step 1 are rendered before generating and assigning new URLs to them.
<pre>&lt;script&gt;
  <b>_IG_RegisterOnloadHandler</b>(function() {
    // This will be executed after gadget loads
  });
&lt;/script&gt;</pre>
    </li>
    <li>
      Inside the event handler function, you can retrieve the <code>clickurl</code> using the 
      <a href="http://www.google.com/apis/gadgets/reference.html#Core">_IG_Prefs</a> object.
      Once you have the <code>clickurl</code>, generate the new trackable URL which is created by taking the
      existing value in <code>href</code>, escaping it, and appending it to the <code>clickurl</code>.
      You can then access the HTML DOM using <code>_gel()</code> and replace the current
      anchor tag's <code>href</code> attribute with the new URL.
<pre>&lt;script&gt;
  _IG_RegisterOnloadHandler(function() {<b>
    // Get anchor tag element 
    var link1 = _gel("link1");
    var prefs = new _IG_Prefs();
    var clickUrl = prefs.getString("clickurl");
    var trackableUrl = clickUrl + _esc(link1.href);
    
    // Replace the existing href attribute for link1 with the new URL
    link1.href = trackableUrl;</b>
  });
&lt;/script&gt;</pre>
      <br>
      Here's a more condensed version:
<pre>&lt;script&gt;
  _IG_RegisterOnloadHandler(function() {<b>
    var prefs = new _IG_Prefs();
    
    // Replace the existing href attribute for link1 with the new URL
    _gel("link1").href = prefs.getString("clickurl") + _esc(_gel("link1").href);</b>
  });
&lt;/script&gt;</pre>
    </li>
  </ol>
</p>

<a name="policy"></a>
<h2>Conforming to IAB and Google Rich Media Advertising Policies</h2>
<p>
  While gadget ads is a format unique to Google, we consider it imperative that
  these ads conform to industry standards and Google's accepted policies around
  rich media and dynamic advertising. It is very important that you conform to
  both IAB (Internet Advertising Board) and Google corporate policies around
  acceptable forms of advertising. Beyond "obvious" guidelines about not
  misleading users, there are some special considerations that may not be obvious
  at first. For example, pages can have multiple ads on them-- so you cannot play
  audio on-load, or the ads will conflict. Google has developed an initial set of
  editorial guidelines that must be adhered to. You can see these guidelines at
  the link below:
</p>
<p>
  <a href="http://adwords.google.com/support/bin/answer.py?answer=66136">http://adwords.google.com/support/bin/answer.py?answer=66136</a>
</p>

<h3>Performance and Bandwidth Use</h3>
<p>
  In many parts of the world, users and companies pay a lot of money for
  bandwidth and so it is important to respect their needs to keep ads small.
  Moreover, if ads slowed down webpages too much, then the web would seem slow
  and we would all suffer. Google has consistently seen that latency and direct
  and obvious impact on the performance of ads. The IAB limits rich media ad
  sizes based on the dimensions of the creative, but no ads are allowed to be
  over 40k on load. Google's preference is always that advertisers should comply
  with the IAB's standards. To view the IAB's standards on rich media, visit the
  document below:
</p>
<p>
  <a href="http://www.iab.net/standards/richmedia/pdf/RichMediaGuidelines3.pdf">http://www.iab.net/standards/richmedia/pdf/RichMediaGuidelines3.pdf</a>
</p>
<p>
  As gadget ads are a new and unique format Google has set a maximum of 50 KB
  (kilobytes) allowed "on load" for an ad during our beta period. The definition
  of "on load" is tricky, but should be taken to mean the size of the ad when it
  is loaded with the page and prior to a consumer interacting with it. If the user
  has "interacted" with the gadget ad, then it is OK to use more than 50KB. Both
  for the 50KB limit and the no-audio rule mentioned above, on-load video is
  generally not possible, but small animation sequences work.
</p>

<h3>Bad Clicks and Misleading Click-Targets</h3>
<p>
  It is trivial to simulate a click with a gadget ad-- obviously, don't do this.
  Beyond threats, click fraud makes no sense for gadget ads--
  click-through-based advertisers ultimate make money when users willingly
  choose to click to learn more about products or services. Fraudulent gadget ad
  clicks increase click through rate, at the expense of conversion. Similarly,
  "tricking" the user into clicking with bad click targets is self-defeating.
</p>
<p>
  The more subtle issue are low click-through rates. For example, if the click
  through URLs are not properly placed, then the gadget will 'work' but fail to
  run if it uses CPC (cost-per-click) advertising. More subtly, your help in
  user interface design can help advertisers understand the implications of CPM
  (paying for impressions, not clicks) vs. CPC vs. CPA (paying for conversion)
  advertising.
</p>
<p>
  Click targets (clicks that lead users to another website) must be visually
  identified as causing click-through vs. in-gadget interactions. Google
  suggests doing this by having all click targets underlined and in a blue font
  color.
</p>

<h3>Animated Ads</h3>
<p>
  Animation is restricted to a maximum of 30 seconds (at a
  15-20 fps frame rate). Endless loops are not allowed. Ads can loop a maximum
  of three times.
</p>

<h3>Privacy and Cookies</h3>
<p>
  Google requires that ads are completely anonymous, and Gadget Ads may not
  create or read cookies, or use other cookie-like mechanisms, e.g. flash local
  storage. We view this as a crucial aspect of respecting our users' privacy.
  This is an very important rule -- do not make mistakes.
</p>

<h3>Downloads and Malware Ads</h3>
<p>
  Gadget Ads cannot download (or attempt to download) any software to the user's
  computer. Currently, IAB/Google do not permit download-links from inside
  gadgets-- we are investigating way(s) of changing these guidelines to allow
  download links from inside gadget ads-- but today, advertisers must place all
  download links on the 'landing page' (destination page from click throughs).
</p>

<h3>Popup Windows</h3>
<p>
  Don't use alert(), confirm() or other "modal" dialog boxes for any reason.
  We also do not allow links to landing pages that generate
  pop-ups when users enter or leave your landing page. We consider a pop-up to
  be any window, regardless of content, that opens in addition to the original
  window.
</p>


<a name="remotecontent"></a>
<h2>Getting Remote Content</h2>
<p>
  One great feature of gadgets is the ability to fetch remote content from third-party
  websites and display it within your gadget.  The API currently offers three different methods to do
  this, depending on the type of content being retrieved:
  <ul>
    <li>
      <a href="http://www.google.com/apis/gadgets/remote-content.html#Fetch_text">_IG_FetchContent(url, func)</a>:
      Fetches content from <code>url</code> and returns the response as text.
      When it's ready, it calls <code>func()</code>. Note that <code>_IG_FetchContent()</code> is asynchronous, 
      meaning that it returns immediately and then calls the inner function later, when the fetch finishes. 
      This means that you must put any dependent code inside the callback function, or inside functions called by the callback function. 
    </li>
    <li>
      <a href="http://www.google.com/apis/gadgets/remote-content.html#Fetch_XML">_IG_FetchXmlContent(url, func)</a>:
      Fetches content from <code>url</code> and returns the response as an XML object.
      When it's ready, calls <code>func()</code>. Like <code>_IG_FetchContent()</code>, is asynchronous.
    </li>
    <li>
      <a href="http://www.google.com/apis/gadgets/remote-content.html#Fetch_JSON">_IG_FetchFeedAsJSON(url, func, num_entries, get_summaries)</a>:
      Fetches the RSS / Atom feed content from <code>url</code> and returns it as a JSON object. When it's ready, calls <code>func()</code>. 
      Fetches the number of feed entries specified by <code>num_entries</code> (default is 3, possible range is 1-100), 
      and optionally fetches additional descriptions depending on the value of <code>summaries</code> (default is false).
    </li>
  </ul>
</p>
<h3>Example: Fetching from an Atom/RSS Feed</h3>
<p>
  Here's an example where the first feed entry is fetched from the Google News
  <a href="http://news.google.com/?output=atom">Atom feed</a> and returned as 
  a <a href="http://www.json.org">JSON object</a>.
  The callback function takes the response and outputs HTML generated from
  the entry title, link, and summary.
<pre>&lt;div id=&quot;out&quot;&gt;&lt;/div&gt;
&lt;script&gt;
  _IG_RegisterOnloadHandler(function() {
    <b>function callback(response) {
      // Retrieve first entry from the response
      var firstEntry = response.Entry[0];
      
      // Generate HTML using the entry's title, link, and summary
      _gel(&quot;out&quot;).innerHTML = [
        &#39;&lt;a href=&quot;&#39; + firstEntry.Link + &#39;&quot;&gt;&#39; + firstEntry.Title + &#39;&lt;/a&gt;&#39;,
        firstEntry.Summary,
      ].join(&quot;&lt;br&gt;&quot;);
    }
    
    // Fetch 1 entry from Google News Atom feed and include summaries
    _IG_FetchFeedAsJSON(&quot;http://news.google.com/?output=atom&quot;, callback, 1, true);</b>
  });
&lt;/script&gt;</pre>
</p>


<a name="images"></a>
<h2>Embedding Images: Recommended</h2>
<p>
  Gadget ads often receive huge amounts of traffic, so it is important to use the Google caching services for rendering images.
  There are two JavaScript functions available for this purpose:
  <ul>
    <li>
      <code>_IG_GetImage(url)</code>: Returns the cached image specified by <code>url</code>.
      This can improve performance in gadgets that have static images and is useful
      when you want to preload images.
    </li>
    <li>
      <code>_IG_GetImageUrl(url)</code>: Returns the proxy URL for the cached 
      version of the image specified by <code>url</code>.
    </li>
  </ul>
</p>
<p>
  In HTML, you'd typically embed an image like this:
  <pre>&lt;img src="http://www.google.com/intl/en_ALL/images/logo.gif"/&gt;</pre>
</p>
<p>
  However, to maximize performance benefits, here's the recommended way to embed images in your gadgets:
<pre>&lt;img id="<b>logoImg</b>" src=""/&gt;
&lt;script&gt;
  _IG_RegisterOnloadHandler(function() {
    <b>_gel("logoImg").src = _IG_GetImageUrl("http://www.google.com/intl/en_ALL/images/logo.gif");</b>
  });
&lt;/script&gt;</pre>
</p>

<h3>Background Images</h3>
<p>
  There are other ways you might include images in your gadgets besides using <code>&lt;img&gt;</code> tags.  
  For example, you can use similar tactics for CSS background images:
<pre>&lt;div id="panel">This content has a background image&lt;/div&gt;
&lt;script&gt;
  _IG_RegisterOnloadHandler(function() {
    <b>_gel("panel").style.background = "transparent url(" + _IG_GetImageUrl("http://www.google.com/intl/en_ALL/images/logo.gif") + ") 0px 0px no-repeat";</b>
  });
&lt;/script&gt;</pre>
</p>

<a name="flash"></a>
<h2>Embedding Flash and Video Content</h2>
<p>
  Many times, you're going to want to embed Flash within your gadget.
  Using our Flash library is the recommended way to embed Flash content in your gadget
  and ensures it works correctly across multiple browsers.  Please visit the
  <a href="http://www.google.com/apis/gadgets/ui.html#Flash">documentation</a>
  for more information.
</p>
<p>
  Here's an example on embedding a Flash application in your gadget using the
  Flash library and setting a custom width and height:
<pre>&lt;div id=&quot;container&quot;&gt;&lt;/div&gt;
&lt;script&gt;
<b>_IG_EmbedFlash(&#39;http://www.mysite.com/flash.swf&#39;, &#39;container&#39;, {
    swf_version: 6,
    id: &quot;flashid&quot;,
    width: 250,
    height: 200
  });</b>
&lt;/script&gt;</pre>
</p>

<a name="flash_cache"></a>
<h3>Caching Flash Content on Google</h3>
<p>
  Similar to caching gadget images, you should also use the cache for Flash content
  to improve gadget performance and decrease the load on hosting servers.  To do
  this, you'll need to use
  <code>_IG_EmbedFlash(url, container, opt_params)</code> in conjunction with 
  another method called <code>_IG_GetCachedUrl(url)</code>, which simply returns
  the proxy URL for the cached version of the file specified by <code>url</code>.
</p>
<p>
  Here's an example where we cache the embedded Flash application:
<pre>_IG_EmbedFlash(<b>_IG_GetCachedUrl(&#39;http://www.mysite.com/flash.swf&#39;)</b>, &#39;container&#39;, {
  swf_version: 6,
  id: &quot;flashid&quot;,
  width: 250,
  height: 200
});</pre>
</p>

<a name="flash_clickurl"></a>
<h3>Passing the Click URL into Flash</h3>
<p>
  You're going to need access to the click URL from your Flash files.  To enable
  this, get the click URL from the userpref and pass it into Flash as a flash variable
  called <b>clickTAG</b>.  You can define
  flash variables by creating a Flash parameter called 'flashvars'.
  Then you can create new variables by specifying name-value pairs
  separated by <code>&amp;</code>. In your Flash file, you'll be able to
  access each variable using ActionScript.
  Here's an example showing you how to format the flashvars string with
  multiple variables:
<pre>var1=value1<b>&amp;</b>var2=value2<b>&amp;</b>var3=value3<b>&amp;</b>var4=value</pre>
</p>
<p>
  Here's an example of how you would pass in the click URL to Flash:
</p>
  <pre>&lt;div id=&#39;container&#39;&gt;&lt;/div&gt;
&lt;script&gt;
  var prefs = new _IG_Prefs();
  var clickUrl = prefs.getString('clickurl') + _esc('http://exampletarget.com');
  _IG_EmbedFlash(_IG_GetCachedUrl(&#39;http://www.youtube.com/v/_YUugB4IUl4&#39;), &#39;container&#39;, {
    swf_version: 6,
    id: &quot;flashid&quot;,
    width: 250,
    height: 200,
    <b>flashvars: 'clickTAG=' + _esc(clickUrl)</b>
  });
&lt;/script&gt;</pre>
</p>

<a name="flash_youtube"></a>
<h3>Using the YouTube Branded Player For Video Playback</h3>
<p>
  For gadget ads, we highly recommend hosting your video on <a href="http://www.youtube.com">YouTube</a>.
  View the <a href="http://www.google.com/support/youtube/bin/topic.py?topic=10524">instructions</a>
  on how to upload videos if you're unfamiliar with the process.  Hosting videos on
  YouTube ensures that your video hosting server will be able to handle the traffic
  and load coming from your gadget ad.  In addition, once your video is hosted,
  you can utilize the advanced YouTube player for video playback in your gadget.
</p>
<p>
  If you want to use the YouTube branded player, that's very easy to do.  
  The YouTube player is simply a Flash application that you can easily 
  embed anywhere in your gadget.  Here's what you need to do.
  <ol>
    <li>
      Find the video on <a href="http://www.youtube.com">YouTube</a> that you want to use.
      If your video doesn't exist on YouTube, <a href="http://www.youtube.com/my_videos_upload">upload</a>
      them now.  Visit their <a href="http://www.google.com/support/youtube/bin/topic.py?topic=10524">help center</a>
      if you need help.
    </li>
    <li>
      Once your video is on YouTube, find the video ID.  You can get this from
      the location of your video.  For example, here's a random video on YouTube
      where the video ID is bolded:
      <pre>http://www.youtube.com/watch?v=<b>aB_c2RwpbXU</b></pre>
    </li>
    <li>
      The location of the YouTube branded player is at:
      <pre>http://www.youtube.com/v/YOUTUBE_VIDEO_ID</pre>
      <br>
      Substitute <code>YOUTUBE_VIDEO_ID</code> with your YouTube video ID.
      This is the URL pointing to the YouTube Flash player that will playback
      the video corresponding to the video ID.
      You can embed this anywhere in your gadget
      just like you would with any other Flash application.
    </li>
  </ol>
</p>

<a name="flash_nonbranded"></a>
<h3>Using your own Flash player with YouTube Videos</h3>
<p>
  If you want to use your own non-branded Flash player to playback videos
  hosted on YouTube, you can!  All you need is the URL pointing to the 
  FLV video hosted on YouTube servers.  With the FLV URL, you can use it
  to stream the video from within your own Flash player.  This is great because
  it removes the burden of having to host the source video yourself.  Streaming
  also helps to keep your file size down because it's not stored locally.
</p>

<style>
  .red, .green, .blue {
    font-weight: bold;
  }
  .red {
    color: #a00;
  }
  .green {
    color: #0a0;
  }
  .blue {
    color: #00a;
  }
</style>
<h4>Building the FLV URL</h4>
<p>
  The first thing you need is the FLV URL.  This can only be created
  from inside the gadget which is later passed into the Flash application
  via flashvars.  Here's how the URL is constructed:
  <pre>http://www.youtube.com/get_video?video_id=<b class="red">YOUTUBE_VIDEO_ID</b>&amp;ts=<b class="green">TIMESTAMP</b>&amp;t=<b class="blue">YOUTUBE_SIGNATURE</b>&amp;gad=1</pre>
  <ul>
    <li>
      <b class="red">YOUTUBE_VIDEO_ID</b>: Replace this field with the YouTube
      video ID.  When you're watching the video on YouTube, the video ID 
      is located in the URL. Example: <code>http://www.youtube.com/watch?v=<b>aB_c2RwpbXU</b></code>
    </li>
    <li>
      <b class="green">TIMESTAMP</b>: Replace this with <code>__ENV_time_secs_since_epoch__</code>.
      This will insert the current time as number of seconds since epoch.
    </li>
    <li>
      <b class="blue">YOUTUBE_SIGNATURE</b>: Replace this with 
      <code>__YOUTUBE_VIDEO_TEST(<b class="red">YOUTUBE_VIDEO_ID</b>)__</code>.
      Fill in the same YouTube video ID as above.  This will create a special
      YouTube signature that's generated based on your video ID.
    </li>
  </ul>
</p>
<h4>Using the FLV URL</h4>
<p>
  Now that you have the FLV URL, you have to pass it to your Flash player.
  Embed your Flash player using <code>_IG_EmbedFlash(...)</code> and create
  a flashvars property with the FLV URL.  
  <br>
  <b>*** Make sure to escape all flashvar values. ***</b>
<pre>var flvUrl = &quot;http://www.youtube.com/get_video?video_id=<b class="red">C5rTJkfBhbQ</b>&amp;ts=<b class="green">__ENV_time_secs_since_epoch__</b>&amp;t=<b class="blue">__YOUTUBE_VIDEO_TEST(C5rTJkfBhbQ)</b>__&amp;gad=1&quot;;
_IG_EmbedFlash(_IG_GetCachedUrl(&quot;http://examplesite.com/myplayer.swf&quot;), &quot;vid&quot;, {
    swf_version: 8, 
    width: 300, 
    height: 250, 
    <b>flashvars: 'flvURL=' + _esc(flvUrl)</b>
  });</pre>
</p>
<h4>Playing the FLV using ActionScript</h4>
<p>
  <ol>
    <li>
      Create a new Flash document that fits the size of your video ad.
    </li>
    <li>
      Open the Library panel (Window > Library). Click "New Video" from the pop-up menu. 
      In the Video Properties dialog box, name the video symbol and select 
      "Video (ActionScript controlled)". Click OK to create a video object.
    </li>
    <li>
      Drag the video object from the Library panel to the Stage to create a 
      video object instance. With the video object selected on the Stage, 
      type "vid" in the Instance Name text box in the Property 
      inspector (Window > Properties > Properties).
    </li>
    <li>
      Select Frame 1 in the Timeline, and open the Actions panel 
      (Window > Actions).  
      Type the following code in the Actions panel:
<pre>
// retrieve FlashVars variables
var url = clickURL;
var flv = flvURL;

// create a NetConnection object
var nc = new NetConnection();

// NetConnection provides playback of streaming FLVs from a local drive or a remote HTTP address.
// By supplying its connect method with a null parameter, we avoid dependence
// on Flash Communication Server (aka Flash Media Server) in order to play
// video hosted on YouTube.
nc.connect(null);

// create a NetStream object
var ns = new NetStream(nc);

// NetStream handles the video stream for NetConnection. The video player 
// instance &quot;vid&quot; cooperates with NetStream and NetConnection by 
// calling the attachVideo() method.
vid.attachVideo(ns);

// call NetStream.play() to load the external FLV. The video will start 
// playing before the file is fully downloaded.
ns.play(flv);

// finally add an event handler to open the clickURL when a visitor clicks 
// on the video ad.
_root.onMouseDown = function(){
    getURL(url, &quot;_blank&quot;);
};
stop();
</pre>
    </li>
  </ol>
</p>
<h4>Example: Simple Example Playing YouTube Videos</h4>
<p>
  <a href="http://gmodules.com/ig/ifr?url=http://gadgetads.googlecode.com/svn/trunk/sample_youtube_flv.xml">Live Preview</a>
  :: 
  <a href="http://gadgetads.googlecode.com/svn/trunk/sample_youtube_flv.xml">Source XML</a>
</p>

<a name="map"></a>
<h2>Embedding Google Maps</h2>
<p>
  It's easy to integrate a Google Map inside your gadgets using the
  <a href="http://www.google.com/apis/maps/">Google Maps API</a>.  When using maps
  within gadgets, you don't need to sign up for a Google Maps API key, and you can
  simply add a reference to the maps JavaScript library to start using it.
</p>

<h3>Start Small</h3>
<p>
  The Google Maps API is fairly large with a constantly growing set of functionality.
  If you've never used the API before, the easiest way to start learning is to 
  work off a simple example and then build your way up.  For example, 
  here's a gadget that displays a small map centered on Palo Alto, CA
  (<a href="http://fusion.google.com/add?moduleurl=http://gadgetads.googlecode.com/svn/trunk/sample_map.xml">add it now</a>):
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;Sample Map&quot;&gt;
  &lt;/ModulePrefs&gt;
  &lt;Content type=&quot;html&quot;&gt;
  &lt;![CDATA[
    &lt;style&gt;
      <b>#map {
        width: 100%;
        height: 300px;
      }</b>
    &lt;/style&gt;
    <b>&lt;div id=&quot;map&quot;&gt;&lt;/div&gt;</b>
    <b>&lt;script src=&quot;http://maps.google.com/maps?file=api&amp;amp;v=2&quot;&gt;&lt;/script&gt;</b>
    &lt;script&gt;
      _IG_RegisterOnloadHandler(function() {<b>
        if (GBrowserIsCompatible()) {
          var map = new GMap2(_gel(&#39;map&#39;));
          map.addControl(new GSmallMapControl());
          map.addControl(new GMapTypeControl());
          map.setCenter(new GLatLng(37.4419, -122.1419), 13);
        }</b>
      });
    &lt;/script&gt;
  ]]&gt; 
  &lt;/Content&gt;
&lt;/Module&gt;</pre>
</p>
<p>
  Once you have a map within your gadget, reference the 
  <a href="http://www.google.com/apis/maps/documentation/">Google Maps API documentation</a>
  and work your way up to more advanced techniques on how to build more functional
  maps.  A great recommended learning tool is to view the source code of existing
  gadgets that uses Google Maps API.  Here's a few that we recommend checking out:
  <ul
    <li><a href="http://www.google.com/ig/directory?url=mapsearch.xml">Google Map Search</a></li>
    <li><a href="http://www.google.com/ig/directory?url=driving_directions.xml">Driving Directions</a></li>
    <li><a href="http://www.google.com/ig/directory?url=http://ralph.feedback.googlepages.com/googlemap.xml">Google Map</a></li>
    <li><a href="http://www.google.com/ig/directory?q=maps"><i>More...</i></a></li>
  </ul>
</p>


<a name="casestudy"></a>
<h2>Case Study: Simplified Gmail Gadget Ad</h2>
<p>
  The Gmail gadget ad is an extremely successful gadget, receiving an average of 1.4 million
  pageviews per week.  It can easily
  be added to your <a href="http://fusion.google.com/add?moduleurl=http://www.labpixies.com/gadgads/gmail/gmail.xml">homepage</a>
  or embedded on other <a href="http://gmodules.com/ig/creator?synd=open&url=http%3A//www.labpixies.com/gadgads/gmail/gmail.xml&pt=%26context%3Ds%26synd%3Dopen%26lang%3Den%26.lang%3Den%26country%3Dus%26.country%3Dus%26cat%3Dall%26q%3Dlabpixies.com%2Bgmail%26num%3D1%26start%3D0%26cols%3D1%26objs%3Dj2j&sn=j2j&lang=en">webpages</a>.
  The best way to learn to write successful gadget ads is by building one yourself.
  So let's build a simplified version of the Gmail gadget ad.  We won't replicate all the functionality
  in the original gadget.  However, by the end, you'll have created a gadget that includes a Gmail video, 
  the branded logo, and a clickable link that allows users to sign up for a Gmail account.
</p>

<h3>Collecting Resources</h3>
<p>
  When initially building a gadget, it's extremely helpful to know what resources are required to build your gadget.
  Resources can be any content in your gadget, like images, URLs, Flash objects, etc.
  Normally, you'd be responsible for finding and/or creating the resources required by your gadget.
  For this example, let's assume you created the resources listed here:
  <ul>
    <li>
      <a href="http://www.youtube.com/v/_YUugB4IUl4">Gmail Video Ad</a> hosted on YouTube
    </li>
    <li>
      <a href="http://www.labpixies.com/gadgads/gmail/images/background.png">Gadget Background Image</a> (300 x 250):<br>
      <img src="http://www.labpixies.com/gadgads/gmail/images/background.png"/>
    </li>
    <li>
      URL pointing to the <a href="http://mail.google.com/mail/help/open.html#utm_campaign=en&utm_source=en-ha-na-us-gadget&utm_medium=ha">Gmail Sign-up Page</a>
    </li>
  </ul>
</p>

<h3>Starting from Scratch</h3>
<p>
  We start with an empty gadget template.  The background image is 300 x 250 pixels.
  Let's set the width and height of the gadget to 300 x 250 by setting the <code>width</code> and <code>height</code> 
  attributes under <code>ModulePrefs</code>.
</p>
<p>
  Since we're still in testing phase, let's also set the <code>clickurl</code> to <code>http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=</code>.
  Your gadget should look something like this:
  
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;Simple Gmail Gadget Ad&quot; <b>width="300" height="250"</b>/&gt;
  <b>&lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=&quot;/&gt;</b>
  &lt;Content type=&quot;html&quot;&gt;&lt;![CDATA[
  ]]&gt;&lt;/Content&gt;
&lt;/Module&gt;</pre>  
</p>

<h3>Create the Content Layout</h3>
<p>
  The background image determines how and where gadget content will be laid out..
  We want the Gmail video ad to be the highlight of this gadget.  So let's make it occupy the main center
  area.  The background image makes room for this.  
  At the top of the image, there are two icons for 'Videos' and 'Secret Tips'.
  We won't be using them in this example, but we have some free space to the right of it.
  Let's place a link there that redirects users to the Gmail sign-up page.
</p>
<p>
  In HTML, we can use tables to help us organize and overlay content
  above specific areas in the background image.
  <ol>
    <li>
      Create an HTML table and set the background image 
      to <code>http://www.labpixies.com/gadgads/gmail/images/background.png</code>.
      Set the table width to 300 pixels to match the width of the background image.
    </li>
    <li>
      Create two table rows, one for the top header, and one for the main content area.  Set the height for 
      the header row to 30, and set main content row height to the fill up the remainder, which comes
      out to around 220.  The two rows should combine to completely
      fill up the gadget's entire vertical space.
    </li>
    <li>
      Temporarily enable table borders to help guide and verify that the
      header and main content rows are split correctly.  Remember to remove them later on 
      when they are no longer needed.
    </li>
  </ol>
</p>
<p>
  Your gadget should now look something like this:
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;Simple Gmail Gadget Ad&quot; width=&quot;300&quot; height=&quot;250&quot;/&gt;
  &lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=&quot;/&gt;
  &lt;Content type=&quot;html&quot;&gt;&lt;![CDATA[
    <b>&lt;table width=&quot;300&quot; id=&quot;main&quot; border=1 cellspacing=0 cellpadding=0&gt;
      &lt;tr height=&quot;30&quot;&gt;
        &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr height=&quot;220&quot;&gt;
        &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;script&gt;
      _IG_RegisterOnloadHandler(function() {
        // Set the background image of the table
        _gel(&quot;main&quot;).style.background = &quot;transparent url(&quot; + _IG_GetImageUrl(&quot;http://www.labpixies.com/gadgads/gmail/images/background.png&quot;) + &quot;)&quot;;
      });
    &lt;/script&gt;</b>
  ]]&gt;&lt;/Content&gt;
&lt;/Module&gt;</pre>
</p>

<h3>Add the Gmail Ad Video</h3>
<p>
  In the main content row of the table, let's embed the <a href="http://www.youtube.com/v/_YUugB4IUl4">Gmail video ad</a>.
  This row has dimensions of 300 x 220 pixels.  Make sure you set the width and height of the embedded video to fit inside
  these dimensions.  Feel free to play around with video dimensions here to create more or less whitespace padding.
</p>
<p>
  <ol>
    <li>
      Since we'll be using the Flash library to embed the YouTube video, add the 
  <code>&lt;Require feature=&quot;flash&quot;/&gt;</code> tag within <code>&lt;ModulePrefs&gt;</code>.
    </li>
    <li>
      Add a container element within the main table cell where the video will be injected.
    </li>
    <li>
      Set the vertical alignment of this table cell to <code>top</code>.  This forces the video to align its
      top border with the very top of the cell, eliminating any whitespace in between.
    </li>
    <li>
      Lastly, add the <code>_IG_EmbedFlash(...)</code> code in JavaScript and remember to
      set the width and height of the embedded video to fit inside the gadget dimensions.
    </li>
  </ol>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;Simple Gmail Gadget Ad&quot; width=&quot;300&quot; height=&quot;250&quot;&gt;
    <b>&lt;Require feature=&quot;flash&quot;/&gt;</b>
  &lt;/ModulePrefs&gt;
  &lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=&quot;/&gt;
  &lt;Content type=&quot;html&quot;&gt;&lt;![CDATA[
    &lt;table width=&quot;300&quot; id=&quot;main&quot; border=0 cellspacing=0 cellpadding=0&gt;
      &lt;tr height=&quot;30&quot;&gt;
        &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr height=&quot;220&quot;&gt;
        &lt;td <b>valign=top</b>&gt;
          <b>&lt;div id=&quot;video&quot;&gt;&lt;/div&gt;</b>
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;script&gt;
      _IG_RegisterOnloadHandler(function() {
        // Set the background image of the table
        _gel(&quot;main&quot;).style.background = &quot;transparent url(&quot; + _IG_GetImageUrl(&quot;http://www.labpixies.com/gadgads/gmail/images/background.png&quot;) + &quot;)&quot;;
        
        <b>// Embed the Gmail video from YouTube
        _IG_EmbedFlash(_IG_GetCachedUrl(&quot;http://www.youtube.com/v/_YUugB4IUl4&quot;), _gel(&quot;video&quot;), {
            width: 300,
            height: 210
          });</b>
      });
    &lt;/script&gt;
  ]]&gt;&lt;/Content&gt;
&lt;/Module&gt;</pre>
</p>

<h3>Insert the Gmail Sign-up Link</h3>
<p>
  In the unused top-right corner, let's create a Gmail sign-up link that redirects
  users to a webpage where they can sign up for a Gmail account.  We want the 
  gadget ad to track clicks on this link.  So we'll
  need to use the <code>clickurl</code> to help create the link.
</p>
<p>
  In this example, the 'Videos' and 'Secret Tips' icons aren't used.  To position the link
  to the right of these icons, we could simply add some left padding to the table cell which
  pushes the link towards the right past the icons.
  Experiment a bit to determine the right amount of padding needed.
  Since the table is 300 pixels wide, a good starting pointing would be around 200 pixels.
  <ol>
    <li>
      Create a new anchor tag inside the table cell of the first row.  Remember to assign
      it an <code>id</code> so we can later add the <code>clickurl</code> to it.
    </li>
    <li>
      Use the <code>style</code> attribute to add left padding to the table cell.
      Fine-tune the padding until the link is correctly positioned to the right of the two icons.
    </li>
    <li>
      If table borders are still enabled, disable them because we no longer need them.
    </li>
  </ol>
  
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title=&quot;Simple Gmail Gadget Ad&quot; width=&quot;300&quot; height=&quot;250&quot;/&gt;
  &lt;UserPref name=&quot;clickurl&quot; datatype=&quot;hidden&quot; default_value=&quot;http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=&quot;/&gt;
  &lt;Content type=&quot;html&quot;&gt;&lt;![CDATA[
    &lt;table width=&quot;300&quot; id=&quot;main&quot; <b>border=0</b> cellspacing=0 cellpadding=0&gt;
      &lt;tr height=&quot;30&quot;&gt;
        <b>&lt;td style=&quot;padding-left: 190px; font-size: 12px;&quot;&gt;
          &lt;a id=&quot;signup&quot; target=&quot;_top&quot; href=&quot;http://mail.google.com/mail/help/open.html#utm_campaign=en&utm_source=en-ha-na-us-gadget&utm_medium=ha&quot;&gt;Sign up for Gmail&lt;/a&gt;
        &lt;/td&gt;</b>
      &lt;/tr&gt;
      &lt;tr height=&quot;220&quot;&gt;        
        &lt;td valign=top&gt;
          &lt;div id=&quot;video&quot;&gt;&lt;/div&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;script&gt;
      _IG_RegisterOnloadHandler(function() {
        <b>// Prepend the click URL to the sign-up link so it can be tracked by the ads system
        var prefs = new _IG_Prefs();
        _gel(&quot;signup&quot;).href = prefs.getString(&quot;clickurl&quot;) + _esc(_gel(&quot;signup&quot;).href);</b>

        // Set the background image of the table
        _gel(&quot;main&quot;).style.background = &quot;transparent url(&quot; + _IG_GetImageUrl(&quot;http://www.labpixies.com/gadgads/gmail/images/background.png&quot;) + &quot;)&quot;;
        
        // Embed the Gmail video from YouTube
        _IG_EmbedFlash(_IG_GetCachedUrl(&quot;http://www.youtube.com/v/_YUugB4IUl4&quot;), _gel(&quot;video&quot;), {
            width: 300,
            height: 210
          });
      });
    &lt;/script&gt;
  ]]&gt;&lt;/Content&gt;
&lt;/Module&gt;</pre>
</p>

<a name="finaloutcome"></a>
<h2>The Final Outcome</h2>
<p>
  Congratulations!  You've just made your first gadget ad.  Here's a live running instance
  showing how the final gadget should look like
  (<a href="http://fusion.google.com/add?moduleurl=http://gadgetads.googlecode.com/svn/trunk/simple_gmail_ad.xml">add it now</a>):
</p>
<p><iframe frameborder=0 width=300 height=250 src="http://gmodules.com/ig/ifr?url=http://gadgetads.googlecode.com/svn/trunk/simple_gmail_ad.xml"></iframe></p>

<a name="resources"></a>
<h2>Resources:</h2>
<p>
  <ul>
    <li><a href="http://www.google.com/apis/gadgets/">Google Gadgets API</a></li>
    <li><a href="http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=">http://gadgetads.googlecode.com/svn/trunk/test_clickurl.html?url=</a></li>
    <li><a href="http://www.google.com/apis/maps/">Google Maps API</a></li>
    <li><a href="http://fusion.google.com/add?moduleurl=http://gadgetads.googlecode.com/svn/trunk/simple_gmail_ad.xml">Simple Gmail Gadget Ad</a></li>
    <li><a href="http://gmodules.com/ig/creator?synd=open&url=http%3A//www.labpixies.com/gadgads/gmail/gmail.xml&pt=%26context%3Ds%26synd%3Dopen%26lang%3Den%26.lang%3Den%26country%3Dus%26.country%3Dus%26cat%3Dall%26q%3Dlabpixies.com%2Bgmail%26num%3D1%26start%3D0%26cols%3D1%26objs%3Dj2j&sn=j2j&lang=en">Original Gmail Gadget Ad</a></li>
    <li><a href="http://groups.google.com/group/Google-Gadgets-API/topics?start=">Discussion Group</a></li>
    <li><a href="http://code.google.com/support/bin/topic.py?topic=10027">Knowledge Base / FAQ</a></li>
    <li><a href="http://www.google.com/ig/directory?synd=branded">Branded Directory / Example Gadgets</a></li>
    <li><a href="mailto:gadget-ads-support@google.com">gadget-ads-support@google.com</a></li>
  </ul>
</p>

<a name="scratchpad"></a>
<h2>Build Gadgets Using the Scratch Pad</h2>
<p>
  One of the quickest and easiest way to start writing gadgets is to use the scratch pad. The scratch pad
  contains two tabs: "Edit" and "Preview".  The "Edit" tab includes a simple text editor that lets
  you edit the gadget XML.  Clicking on "Preview" lets you instantly view live results of 
  your changes, without ever leaving the webpage.
</p>
<p>
  Underneath the scratch pad, there are links to other gadget ads.  Clicking on any of them loads the gadget
  spec into the editor where you can view the XML, modify it, and preview the effects of your changes.
  The <a href="http://www.google.com/ig/modules/hello.xml">Hello World</a> gadget is loaded by default.
</p>
<p>
  There are different ways to use the scratch pad:
  <ul>
    <li>Edit the "Hello World" gadget spec that is displayed in the scratchpad by default.</li>
    <li>Click on any gadget ad link underneath the scratchpad to display, edit, and preview the gadget spec.</li>
    <li>Paste any gadget spec into the scratch pad to edit it and preview the results, or write a gadget from scratch.</li>
  </ul>
</p>
<p>
  <iframe style="width:100%; height:530px;" frameborder=0 scrolling=no src="http://gmodules.com/ig/ifr?url=http://gadgetads.googlecode.com/svn/trunk/scratchpad_ads.xml&amp;synd=open&amp;up_height=450"></iframe>
</p>
</body>
</html>
